pool:
  vmImage: 'windows-2019'

steps:
- task: colinsalmcorner.colinsalmcorner-buildtasks.tag-build-task.tagBuildOrRelease@0
  displayName: 'Tag Build with Build.Reason=$(Build.Reason) NextBuild=$(NextBuild) '
  inputs:
    tags: |
      Build.Reason=$(Build.Reason)
      NextBuild=$(NextBuild)
  continueOnError: true

#variables:
  # NextBuild: define in Azure
  # PipelinesPersonalAccessToken: define in Azure

- task: benjhuser.tfs-extensions-build-tasks.trigger-build-task.TriggerBuild@3
  displayName: 'Trigger build $(NextBuild)'
  inputs:
    buildDefinition: '$(NextBuild)'
    queueBuildForUserThatTriggeredBuild: false
    password: '$(PipelinesPersonalAccessToken)'
    enableBuildInQueueCondition: true
    blockingBuildsList: '$(NextBuild)'
  condition: and(succeededOrFailed(), ne(variables['Build.Reason'], 'xxyxyx'), ne(variables['NextBuild'], ''), ne(variables['PipelinesPersonalAccessToken'], ''))
  continueOnError: true
