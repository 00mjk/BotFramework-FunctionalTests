steps:
- task: DotNetCoreCLI@2
  displayName: 'Add stable BotBuilder version'
  condition: eq(variables['BotBuilderPackageVersion'],'stable')
  inputs:
    command: custom
    projects: $(Parameters.project)
    custom: add
    arguments: 'package Microsoft.Bot.Builder.Integration.AspNet.Core'

- powershell: |
    if ($null -eq $env:BotBuilderPackageVersion -or '' -eq $env:BotBuilderPackageVersion) {
        $Response = Invoke-WebRequest -URI https://botbuilder.myget.org/F/botbuilder-v4-dotnet-daily/api/v3/registration1/Microsoft.Bot.Builder/index.json | ConvertFrom-Json;
        $LastPackage = $Response.items | Select-Object -Last 1
        $latest_version = $lastpackage.upper
  
        echo "##vso[task.setvariable variable=BotBuilderPackageVersion;]$latest_version"
        Write-Host "Set package version to install $latest_version"
    }
  displayName: 'Get package BotBuilder preview version'
  condition: eq(variables['BotBuilderPackageVersion'], '')

- task: DotNetCoreCLI@2
  displayName: 'Add custom BotBuilder version'
  condition: and(ne(variables['BotBuilderPackageVersion'],''), ne(variables['BotBuilderPackageVersion'],'stable'))
  inputs:
    command: custom
    projects: $(Parameters.project)
    custom: add
    arguments: 'package Microsoft.Bot.Builder.Integration.AspNet.Core --version "$(BotBuilderPackageVersion)" --source "https://botbuilder.myget.org/F/botbuilder-v4-dotnet-daily/api/v3/index.json"'